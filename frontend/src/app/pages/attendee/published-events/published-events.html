<section class="attendee-home">
  <header class="page-header">
    <div class="page-intro">
      <h1>Published Events</h1>
      <p>Review schedules, adjust ticket tiers, and retire events that are no longer needed.</p>
    </div>
  </header>

  @if (showQuickGuide) {
    <div class="attendee-guide">
      <app-quick-guide-card
        [avatarIcon]="attendeeQuickGuide.icon"
        [title]="attendeeQuickGuide.title"
        [subtitle]="attendeeQuickGuide.subtitle"
        [steps]="attendeeQuickGuide.steps"
        (dismissed)="showQuickGuide = false"
      />
    </div>
  }

  <form class="filters" [formGroup]="filtersForm">
    <mat-form-field class="filters__field filters__field--search" appearance="outline">
      <mat-label>Search events</mat-label>
      <input matInput placeholder="Search by name, description, or venue" formControlName="query" />
      @if (filtersForm.controls.query.value) {
        <button
          mat-icon-button
          type="button"
          matSuffix
          aria-label="Clear search text"
          (click)="filtersForm.controls.query.setValue('')">
          <mat-icon>close</mat-icon>
        </button>
      }
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>

    <mat-form-field class="filters__field" appearance="outline">
      <mat-label>Event type</mat-label>
      <mat-select formControlName="type">
        <mat-option value="">All types</mat-option>
        @for (type of eventTypes; track type) {
          <mat-option [value]="type">{{ type | titlecase }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <button
      mat-button
      type="button"
      class="filters__reset"
      (click)="resetFilters()"
      [disabled]="!filtersForm.controls.query.value && !filtersForm.controls.type.value">
      Reset filters
    </button>
  </form>

  @if (loading) {
    <div class="loading">
      <mat-spinner diameter="40"></mat-spinner>
      <span>Loading events…</span>
    </div>
  } @else if (error) {
    <div class="error">{{ error }}</div>
  } @else if (events.length === 0) {
    <div class="empty">No events available.</div>
  } @else {
    <div class="card-grid">
      @for (event of events; track event.id) {
        <mat-card class="event-card" appearance="outlined">
          <div class="event-image" [style.background-image]="'url(' + getEventImage(event.type) + ')' "></div>
          <mat-card-header>
            <mat-card-title>{{ event.name }}</mat-card-title>
            <mat-card-subtitle>{{ event.type }} • {{ event.venue }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="time">
              <span class="label">Starts:</span>
              <span>{{ event.start | date: 'medium' }}</span>
            </div>
            <div class="time">
              <span class="label">Ends:</span>
              <span>{{ event.end | date: 'medium' }}</span>
            </div>
          </mat-card-content>
          <mat-card-actions align="end">
            <button mat-button color="primary" (click)="viewDetails(event)">View details</button>
          </mat-card-actions>
        </mat-card>
      }
    </div>
  }

  @if (page; as pageData) {
    @if (pageData.totalPages > 1) {
      <mat-paginator
        [length]="pageData.totalElements"
        [pageSize]="pageData.size"
        [pageIndex]="pageData.number"
        [pageSizeOptions]="pageSizeOptions"
        (page)="onPageChange($event)"
        aria-label="Event pagination">
      </mat-paginator>
    }
  }
</section>
