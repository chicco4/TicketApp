<section class="page page--wide attendee-tickets">
  <header class="page__header">
    <div class="page__intro">
      <h1 class="page__title">My Tickets</h1>
      <p class="page__subtitle">
        Review your upcoming and past tickets, confirm their status, and access event entry details in one place.
      </p>
    </div>
  </header>

  @if (showQuickGuide) {
    <div class="page__section tickets-guide">
      <app-quick-guide-card
        [avatarIcon]="ticketsQuickGuide.icon"
        [title]="ticketsQuickGuide.title"
        [subtitle]="ticketsQuickGuide.subtitle"
        [steps]="ticketsQuickGuide.steps"
        (dismissed)="showQuickGuide = false"
      />
    </div>
  }

  @if (loading) {
    <div class="page__state loading">
      <mat-spinner diameter="40"></mat-spinner>
      <span>Loading ticketsâ€¦</span>
    </div>
  } @else if (error) {
    <div class="page__alert page__alert--error error">
      <p>{{ error }}</p>
      <button mat-stroked-button color="primary" (click)="loadTickets(page?.number ?? 0)">Try again</button>
    </div>
  } @else {
    @if (tickets.length === 0) {
      <p class="page__empty empty">You have not purchased any tickets yet.</p>
    } @else {
      <div class="ticket-grid">
        @for (ticket of tickets; track ticket.id) {
          <mat-card appearance="outlined" class="ticket-card">
            <mat-card-header>
              <mat-card-title>{{ ticket.ticketType.name || 'Ticket' }}</mat-card-title>
              <mat-card-subtitle>
                <span class="status" [ngClass]="getStatusClass(ticket.status)">{{ ticket.status }}</span>
              </mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div class="ticket-info">
                <span class="label">Ticket ID:</span>
                <span class="value monospace">{{ ticket.id }}</span>
              </div>
              @if (ticket.ticketType.price != null) {
                <div class="ticket-info">
                  <span class="label">Price:</span>
                  <span class="value">{{ ticket.ticketType.price | money }}</span>
                </div>
              }
            </mat-card-content>
            <mat-card-actions align="end">
              <button mat-flat-button color="primary" (click)="viewDetails(ticket)">View details</button>
            </mat-card-actions>
          </mat-card>
        }
      </div>
    }
  }

  @if (page; as pageData) {
    @if (pageData.totalElements > pageSize) {
      <mat-paginator
        [length]="pageData.totalElements"
        [pageIndex]="pageData.number"
        [pageSize]="pageSize"
        [pageSizeOptions]="[pageSize]"
        [hidePageSize]="true"
        (page)="onPageChange($event)"
      ></mat-paginator>
    }
  }
</section>
