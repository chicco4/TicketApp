<section class="purchase-ticket">
  @if (loading) {
    <div class="loading">
      <mat-spinner diameter="40"></mat-spinner>
      <span>Loadingâ€¦</span>
    </div>
  }
  @else if (error) {
    <div class="error">{{ error }}</div>
    <button mat-button color="primary" (click)="goBack()">Back</button>
  }
  @else if (event && ticketType) {
    <mat-card appearance="outlined" class="purchase-card">
      <mat-card-header>
        <mat-card-title>Purchase Ticket</mat-card-title>
        <mat-card-subtitle>{{ event.name }}</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="ticket-summary">
          <div class="ticket-info">
            <h3>{{ ticketType.name }}</h3>
            <p class="description">{{ ticketType.description }}</p>
            <p class="price">{{ ticketType.price | currency }} per ticket</p>
          </div>

          <div class="event-info">
            <p><strong>Event:</strong> {{ event.name }}</p>
            <p><strong>Venue:</strong> {{ event.venue }}</p>
            <p><strong>Date:</strong> {{ event.start | date: 'medium' }}</p>
          </div>
        </div>

        <form [formGroup]="purchaseForm" (ngSubmit)="onSubmit()" class="purchase-form">
          <mat-form-field appearance="outline">
            <mat-label>Quantity</mat-label>
            <input matInput type="number" formControlName="quantity" min="1" max="10">
            @if (purchaseForm.get('quantity')?.hasError('required')) {
              <mat-error>Quantity is required</mat-error>
            }
            @if (purchaseForm.get('quantity')?.hasError('min')) {
              <mat-error>Minimum quantity is 1</mat-error>
            }
            @if (purchaseForm.get('quantity')?.hasError('max')) {
              <mat-error>Maximum quantity is 10</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Full Name</mat-label>
            <input matInput formControlName="name" placeholder="John Doe">
            @if (purchaseForm.get('name')?.hasError('required')) {
              <mat-error>Name is required</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input matInput type="email" formControlName="email" placeholder="john@example.com">
            @if (purchaseForm.get('email')?.hasError('required')) {
              <mat-error>Email is required</mat-error>
            }
            @if (purchaseForm.get('email')?.hasError('email')) {
              <mat-error>Please enter a valid email</mat-error>
            }
          </mat-form-field>

          <div class="total">
            <strong>Total:</strong>
            <span class="total-amount">{{ getTotalPrice() | currency }}</span>
          </div>
        </form>
      </mat-card-content>

      <mat-card-actions align="end">
        <button mat-button (click)="goBack()">Cancel</button>
        <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="!purchaseForm.valid">
          Complete Purchase
        </button>
      </mat-card-actions>
    </mat-card>
  }
</section>
