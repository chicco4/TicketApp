<div class="page-container">
  <section class="page-header">
    <div class="page-intro">
      <h1>Manage Events</h1>
      <p>Review schedules, adjust ticket tiers, and retire events that are no longer needed.</p>
    </div>
    <a mat-stroked-button color="accent" routerLink="/organizer/create-event">
      <mat-icon>add_circle</mat-icon>
      <span>Create event</span>
    </a>
  </section>

  <div class="organizer-guide">
    <mat-card appearance="outlined" class="guide-card">
      <mat-card-header>
        <div mat-card-avatar class="guide-avatar">
          <mat-icon>business_center</mat-icon>
        </div>
        <mat-card-title>Organizer Quick Guide</mat-card-title>
        <mat-card-subtitle>Master event management in three simple steps.</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <mat-list class="dense-list">
          <mat-list-item>
            <mat-icon matListItemIcon>add_circle</mat-icon>
            <div matListItemTitle>Create events with detailed schedules, venues, and ticket configurations.</div>
          </mat-list-item>
          <mat-list-item>
            <mat-icon matListItemIcon>edit</mat-icon>
            <div matListItemTitle>Edit event details, adjust pricing, and manage ticket availability in real-time.</div>
          </mat-list-item>
          <mat-list-item>
            <mat-icon matListItemIcon>analytics</mat-icon>
            <div matListItemTitle>Monitor sales performance and manage event status from draft to published.</div>
          </mat-list-item>
        </mat-list>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="alert success" *ngIf="submissionSuccess">
    <mat-icon>check_circle</mat-icon>
    <span>{{ submissionSuccess }}</span>
  </div>

  <div class="alert error" *ngIf="error">
    <mat-icon>error_outline</mat-icon>
    <span>{{ error }}</span>
  </div>

  <div class="loading-container" *ngIf="loading">
    <mat-progress-spinner diameter="48" strokeWidth="4" mode="indeterminate"></mat-progress-spinner>
  </div>

  <section class="events-grid" *ngIf="!loading && events.length; else noEvents">
  <mat-card appearance="outlined" class="event-card" *ngFor="let event of events; trackBy: trackByEventId">
      <mat-card-header>
        <div mat-card-avatar class="card-avatar">
          <mat-icon>event</mat-icon>
        </div>
        <mat-card-title>{{ event.name }}</mat-card-title>
        <mat-card-subtitle>{{ event.status }} &middot; {{ event.type }}</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="meta-grid">
          <div>
            <span class="label">Venue</span>
            <p>{{ event.venue }}</p>
          </div>
          <div>
            <span class="label">Starts</span>
            <p>{{ event.start | date: 'medium' }}</p>
          </div>
          <div>
            <span class="label">Ends</span>
            <p>{{ event.end | date: 'medium' }}</p>
          </div>
          <div>
            <span class="label">Sales window</span>
            <p>
              <span>{{ event.salesStart ? (event.salesStart | date: 'medium') : 'Not set' }}</span>
              <span> - </span>
              <span>{{ event.salesEnd ? (event.salesEnd | date: 'medium') : 'Not set' }}</span>
            </p>
          </div>
        </div>

        <p class="description" *ngIf="event.description">{{ event.description }}</p>

        <mat-divider></mat-divider>

        <div class="ticket-types">
          <h3>Ticket types</h3>
          <mat-list *ngIf="event.ticketTypes?.length; else noTickets">
            <mat-list-item *ngFor="let ticket of event.ticketTypes; trackBy: trackTicketType">
              <mat-icon matListItemIcon>confirmation_number</mat-icon>
              <div matListItemTitle>{{ ticket.name }}</div>
              <div matListItemLine>
                <span>${{ ticket.price | number: '1.2-2' }}</span>
                <span *ngIf="ticket.totalAvailable !== undefined"> &middot; {{ ticket.totalAvailable }} available</span>
              </div>
            </mat-list-item>
          </mat-list>
          <ng-template #noTickets>
            <p class="no-tickets">No ticket types configured for this event.</p>
          </ng-template>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-stroked-button color="primary" type="button" [routerLink]="['/organizer/update-event', event.id]" [disabled]="isDeleting(event.id)">
          <mat-icon>edit</mat-icon>
          <span>Edit</span>
        </button>
        <button mat-button color="warn" type="button" (click)="deleteEvent(event)" [disabled]="isDeleting(event.id)">
          <ng-container *ngIf="!isDeleting(event.id); else deletingSpinner">
            <mat-icon>delete</mat-icon>
            <span>Delete</span>
          </ng-container>
          <ng-template #deletingSpinner>
            <mat-progress-spinner class="inline-spinner" diameter="20" strokeWidth="3" mode="indeterminate"></mat-progress-spinner>
            <span>Deleting...</span>
          </ng-template>
        </button>
      </mat-card-actions>
    </mat-card>
  </section>

  <mat-paginator
    *ngIf="page && page.totalPages > 1"
    [length]="page.totalElements"
    [pageIndex]="page.number"
    [pageSize]="page.size"
    [pageSizeOptions]="[page.size]"
    (page)="onPageChange($event)"
  ></mat-paginator>

  <ng-template #noEvents>
    <div class="empty-state" *ngIf="!loading && !events.length && !error">
      <mat-icon>lightbulb</mat-icon>
      <h2>No events yet</h2>
      <p>Create your first event to start selling tickets.</p>
      <a mat-stroked-button color="accent" routerLink="/organizer/create-event">
        <mat-icon>add_circle</mat-icon>
        <span>Create an event</span>
      </a>
    </div>
  </ng-template>
</div>
