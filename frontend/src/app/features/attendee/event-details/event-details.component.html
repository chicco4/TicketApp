<div class="event-details-container">
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading event details...</p>
  </div>

  <div *ngIf="error && !loading" class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      Back to Events
    </button>
  </div>

  <div *ngIf="event && !loading" class="event-content">
    <button mat-button class="back-button" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      Back to Events
    </button>

    <mat-card class="event-card">
      <mat-card-header>
        <mat-card-title>{{ event.title }}</mat-card-title>
        <mat-chip [color]="event.status === EventStatus.PUBLISHED ? 'primary' : 'warn'">
          {{ event.status }}
        </mat-chip>
      </mat-card-header>

      <mat-card-content>
        <div class="event-info">
          <div class="info-row">
            <mat-icon>description</mat-icon>
            <div>
              <h3>Description</h3>
              <p>{{ event.description }}</p>
            </div>
          </div>

          <div class="info-row">
            <mat-icon>calendar_today</mat-icon>
            <div>
              <h3>Date & Time</h3>
              <p>{{ event.startDate | dateFormat:'long' }} - {{ event.endDate | dateFormat:'long' }}</p>
            </div>
          </div>

          <div class="info-row">
            <mat-icon>location_on</mat-icon>
            <div>
              <h3>Location</h3>
              <p>{{ event.location }}</p>
            </div>
          </div>

          <div class="info-row">
            <mat-icon>category</mat-icon>
            <div>
              <h3>Event Type</h3>
              <p>{{ event.type }}</p>
            </div>
          </div>
        </div>

        <div class="tickets-section">
          <h2>Available Tickets</h2>
          <div class="tickets-grid">
            <mat-card *ngFor="let ticketType of event.ticketTypes" class="ticket-type-card">
              <mat-card-header>
                <mat-card-title>{{ ticketType.name }}</mat-card-title>
                <mat-card-subtitle>{{ ticketType.description }}</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div class="ticket-details">
                  <div class="price">{{ ticketType.price | currency:'USD' }}</div>
                  <div class="availability">
                    <span class="label">Available:</span>
                    <span class="value">{{ ticketType.availableQuantity }} / {{ ticketType.totalQuantity }}</span>
                  </div>
                </div>
              </mat-card-content>
              <mat-card-actions>
                <button 
                  mat-raised-button 
                  color="primary" 
                  [disabled]="ticketType.availableQuantity === 0 || purchasing || event.status !== EventStatus.PUBLISHED"
                  (click)="purchaseTicket(ticketType.id)">
                  <mat-icon>shopping_cart</mat-icon>
                  {{ ticketType.availableQuantity === 0 ? 'Sold Out' : 'Purchase' }}
                </button>
              </mat-card-actions>
            </mat-card>
          </div>

          <div *ngIf="!event.ticketTypes || event.ticketTypes.length === 0" class="no-tickets">
            <mat-icon>info</mat-icon>
            <p>No tickets available for this event</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
